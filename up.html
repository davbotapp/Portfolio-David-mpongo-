<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Davbot Uptime Monitor PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:#0d1117;
  color:#c9d1d9;
}
header{
  background:#161b22;
  padding:15px;
  text-align:center;
  font-size:22px;
  color:#58a6ff;
  font-weight:bold;
}
#netStatus{
  font-size:13px;
  margin-top:5px;
}
nav{
  display:flex;
}
nav button{
  flex:1;
  padding:12px;
  background:#21262d;
  border:none;
  color:#58a6ff;
  font-weight:bold;
  cursor:pointer;
}
nav button.active{
  background:#0d1117;
  border-bottom:2px solid #58a6ff;
}
.container{padding:15px;}

input,button{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:6px;
  border:none;
}
input{
  background:#21262d;
  color:#c9d1d9;
  border:1px solid #30363d;
}
button{
  background:#238636;
  color:white;
  cursor:pointer;
}
button:hover{background:#2ea043}

.hidden{display:none}

/* STATS */
.stats{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:10px;
  margin-bottom:15px;
}
.stat{
  background:#161b22;
  padding:12px;
  border-radius:6px;
  text-align:center;
  border:1px solid #30363d;
}

/* SITE CARD */
.site{
  background:#161b22;
  border:1px solid #30363d;
  border-left:4px solid #58a6ff;
  padding:12px;
  margin-bottom:12px;
  border-radius:6px;
  animation:fadeIn .5s;
}
.site.up{
  box-shadow:0 0 12px rgba(63,185,80,.4);
  animation:pulse 2s infinite;
}
.site.down{
  box-shadow:0 0 12px rgba(248,81,73,.4);
  animation:shake .4s;
}
.flex{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.small{font-size:13px;opacity:.85}
.upText{color:#3fb950}
.downText{color:#f85149}
.danger{
  background:#f85149;
}
.danger:hover{background:#da3633}

@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.02)}
  100%{transform:scale(1)}
}
@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-4px)}
  50%{transform:translateX(4px)}
  100%{transform:translateX(0)}
}
@keyframes fadeIn{
  from{opacity:0;transform:translateY(10px)}
  to{opacity:1;transform:none}
}
</style>
</head>

<body>

<header>
üì° Davbot Uptime Monitor PRO
<div id="netStatus"></div>
</header>

<nav>
  <button class="active" onclick="switchTab('add',this)">Ajouter</button>
  <button onclick="switchTab('dashboard',this)">Dashboard</button>
</nav>

<div class="container">

<!-- AJOUT -->
<div id="add">
  <input id="siteName" placeholder="Nom du site">
  <input id="siteUrl" placeholder="https://exemple.com">
  <button onclick="addSite()">‚ûï Ajouter le site</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">
  <div class="stats" id="stats"></div>
  <div id="sites"></div>
  <button onclick="checkAll()">üîÑ V√©rifier maintenant</button>
</div>

</div>

<script>
let sites = JSON.parse(localStorage.getItem("davbot_uptime") || "[]");

function save(){
  localStorage.setItem("davbot_uptime", JSON.stringify(sites));
}

/* TABS */
function switchTab(id, btn){
  document.querySelectorAll('.container > div').forEach(d=>d.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  if(id === "dashboard") render();
}

/* ADD SITE */
function addSite(){
  const siteName = document.getElementById("siteName").value.trim();
  const siteUrl  = document.getElementById("siteUrl").value.trim();

  if(siteName === "" || siteUrl === ""){
    alert("Veuillez remplir tous les champs");
    return;
  }

  sites.push({
    name: siteName,
    url: siteUrl,
    up: 0,
    down: 0,
    ms: [],
    last: "Jamais"
  });

  save();
  document.getElementById("siteName").value = "";
  document.getElementById("siteUrl").value = "";

  alert("Site ajout√© avec succ√®s ‚úÖ");
}

/* RENDER */
function render(){
  updateStats();
  const box = document.getElementById("sites");
  box.innerHTML = "";

  if(!sites.length){
    box.innerHTML = "<p>Aucun site surveill√©.</p>";
    return;
  }

  sites.forEach((s,i)=>{
    const div = document.createElement("div");
    div.className = "site";
    div.innerHTML = `
      <div class="flex">
        <strong>${s.name}</strong>
        <button class="danger" onclick="removeSite(${i})">‚úñ</button>
      </div>
      <a href="${s.url}" target="_blank" style="color:#58a6ff">${s.url}</a>
      <p id="status${i}" class="small">‚è≥ V√©rification...</p>
      <p class="small">üïí ${s.last}</p>
    `;
    box.appendChild(div);
    checkSite(i, div);
  });
}

/* CHECK SITE ‚Äì D√âTECTION R√âELLE */
function checkSite(i, div){
  const s = sites[i];
  const status = document.getElementById("status"+i);

  if(!navigator.onLine){
    div.classList.add("down");
    status.innerHTML = "üî¥ Hors ligne (pas d'internet)";
    status.className = "small downText";
    return;
  }

  const start = performance.now();
  const img = new Image();

  const timeout = setTimeout(()=>{
    img.src = "";
    s.down++;
    div.classList.add("down");
    status.innerHTML = "üî¥ Inaccessible / introuvable";
    status.className = "small downText";
    s.last = new Date().toLocaleString();
    save();
    updateStats();
  },8000);

  img.onload = ()=>{
    clearTimeout(timeout);
    const ms = Math.round(performance.now() - start);
    s.up++;
    s.ms.push(ms);
    div.classList.add("up");
    status.innerHTML = `üü¢ EN LIGNE ‚Äî ${ms} ms`;
    status.className = "small upText";
    s.last = new Date().toLocaleString();
    save();
    updateStats();
  };

  img.onerror = ()=>{
    clearTimeout(timeout);
    s.down++;
    div.classList.add("down");
    status.innerHTML = "üî¥ Hors ligne / domaine invalide";
    status.className = "small downText";
    s.last = new Date().toLocaleString();
    save();
    updateStats();
  };

  img.src = s.url.replace(/\/$/,"") + "/favicon.ico?" + Date.now();
}

/* STATS */
function updateStats(){
  let total = sites.length, up = 0, down = 0, avg = 0, count = 0;
  sites.forEach(s=>{
    up += s.up;
    down += s.down;
    s.ms.forEach(m=>{avg+=m;count++;});
  });
  avg = count ? Math.round(avg/count) : 0;

  document.getElementById("stats").innerHTML = `
    <div class="stat">üåç Sites<br><strong>${total}</strong></div>
    <div class="stat upText">üü¢ UP<br><strong>${up}</strong></div>
    <div class="stat downText">üî¥ DOWN<br><strong>${down}</strong></div>
    <div class="stat">‚ö° Moyenne<br><strong>${avg} ms</strong></div>
  `;
}

/* UTIL */
function checkAll(){ render(); }
function removeSite(i){
  if(confirm("Supprimer ce site ?")){
    sites.splice(i,1);
    save();
    render();
  }
}

/* INTERNET STATUS */
function netStatusUpdate(){
  const el = document.getElementById("netStatus");
  if(navigator.onLine){
    el.innerHTML = "üü¢ Connexion Internet active";
    el.style.color = "#3fb950";
  }else{
    el.innerHTML = "üî¥ Hors ligne ‚Äì Monitoring suspendu";
    el.style.color = "#f85149";
  }
}
window.addEventListener("online", netStatusUpdate);
window.addEventListener("offline", netStatusUpdate);
netStatusUpdate();

/* AUTO CHECK */
setInterval(()=>{
  if(!document.getElementById("dashboard").classList.contains("hidden")){
    render();
  }
},30000);
</script>

</body>
</html>
